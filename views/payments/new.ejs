<div class="max-w-md mx-auto card">
  <h2 class="text-lg font-medium mb-4">Registrar pago</h2>
  <form id="pagoForm" action="/payments" method="post" class="space-y-3">
    <div>
      <label class="block text-sm text-gray-700">Contrato</label>
      <select name="lease_id" class="w-full border rounded px-3 py-2" required>
        <% leases.forEach(l => { %>
          <option value="<%= l.id %>"><%= l.tenant %> — <%= l.room_code %></option>
        <% }) %>
      </select>
    </div>
    <div>
      <label class="block text-sm text-gray-700">Periodo inicio</label>
      <input class="w-full border rounded px-3 py-2" name="period_start" type="date" required>
    </div>
    <div>
      <label class="block text-sm text-gray-700">Periodo fin</label>
      <input class="w-full border rounded px-3 py-2" name="period_end" type="date" required>
    </div>
    <div>
      <label class="block text-sm text-gray-700">Monto</label>
      <input class="w-full border rounded px-3 py-2" name="amount" type="number" step="0.01" required>
    </div>
    <div>
      <label class="block text-sm text-gray-700">Método</label>
      <select class="w-full border rounded px-3 py-2" name="method" required>
        <option value="">Selecciona método</option>
        <option value="Efectivo">Efectivo</option>
        <option value="Yape">Yape</option>
        <option value="Plin">Plin</option>
        <option value="Tarjeta">Tarjeta</option>
      </select>
    </div>
    <div>
      <button class="bg-blue-600 text-white px-4 py-2 rounded" type="submit">Registrar</button>
    </div>
  </form>
    <script src="/js/sweetalert2.all.min.js"></script>

  <script>
    document.getElementById('pagoForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);
      const body = new URLSearchParams();
      for (const pair of data) {
        body.append(pair[0], pair[1]);
      }
      try {
        const res = await fetch(form.action, {
          method: 'POST',
          headers: { 'Accept': 'text/html' },
          body
        });
        if (!res.ok) {
          const text = await res.text();
          Swal.fire({ icon: 'error', title: 'Error', text });
        } else {
          window.location.href = '/payments';
        }
      } catch (err) {
        Swal.fire({ icon: 'error', title: 'Error', text: 'Error de red o servidor.' });
      }
    });
  </script>
</div>
