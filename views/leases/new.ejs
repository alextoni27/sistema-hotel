<%- include('../_layout_top') %>
<div class="max-w-lg mx-auto card">
  <h2 class="text-lg font-medium mb-4">Nuevo contrato</h2>
  <form action="/leases" method="post" class="space-y-3">
    <div>
      <label class="block text-sm text-gray-700">Inquilino</label>
      <select name="tenant_id" class="w-full border rounded px-3 py-2">
        <% tenants.forEach(t => { %>
          <option value="<%= t.id %>"><%= t.full_name %></option>
        <% }) %>
      </select>
    </div>
    <div>
      <label class="block text-sm text-gray-700">Cuarto</label>
      <select name="room_id" class="w-full border rounded px-3 py-2" id="room_id_select">
        <% rooms.forEach(r => { %>
          <option value="<%= r.id %>" <%= selectedRoomId && String(selectedRoomId) === String(r.id) ? 'selected' : '' %>><%= r.type %> - <%= r.house %> Piso:<%= r.floor %> Cuarto:<%= r.number %></option>
        <% }) %>
      </select>
      <script>
        // Selecciona automáticamente el cuarto si viene por query param
        (function() {
          const params = new URLSearchParams(window.location.search);
          const roomId = params.get('room_id');
          if(roomId) {
            const select = document.getElementById('room_id_select');
            if(select) select.value = roomId;
          }
        })();
      </script>
    </div>
    <div>
      <label class="block text-sm text-gray-700">Fecha inicio</label>
      <input class="w-full border rounded px-3 py-2" name="start_date" type="date" value="<%= typeof lease !== 'undefined' && lease.start_date ? lease.start_date.toISOString().slice(0,10) : '' %>" required>
    </div>
    <div>
      <label class="block text-sm text-gray-700">Fecha fin</label>
      <input class="w-full border rounded px-3 py-2" name="end_date" type="date" value="<%= typeof lease !== 'undefined' && lease.end_date ? lease.end_date.toISOString().slice(0,10) : '' %>">
    </div>
    <div>
      <label class="block text-sm text-gray-700">Precio mensual</label>
      <input class="w-full border rounded px-3 py-2" name="monthly_price" type="number" step="0.01" required>
    </div>
    <div>
      <label class="block text-sm text-gray-700">Depósito</label>
      <input class="w-full border rounded px-3 py-2" name="deposit" type="number" step="0.01">
    </div>
    <div>
      <button class="bg-blue-600 text-white px-4 py-2 rounded flex items-center gap-2 btn-small" type="submit">
        <svg class="w-4 h-4" aria-hidden="true"><use href="#icon-key" /></svg>
        Crear contrato
      </button>
    </div>
  </form>
</div>
</div>
<%- include('../_layout_bottom') %>
